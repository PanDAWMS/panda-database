# PanDA Database Schema Patch 0.0.31

**Version:** 0.0.31  
**Upgrade from:** 0.0.30  
**Date:** November 2025

## Overview

This patch adds worker-node queue tracking and two reporting materialized views in the `doma_panda` schema:

- `doma_panda.worker_node_queue` (new table)
- `doma_panda.mv_worker_node_summary` (CPU summary per panda_queue)
- `doma_panda.mv_worker_node_gpu_summary` (GPU inventory summary)

The materialized views compute per-queue percentages and are intended to refresh hourly.  
Per 0.0.30, versioning continues to use a single **PanDA** component in `pandadb_version`. (See 0.0.30 docs for the versioning shift.).

## Files in this Patch

1. **0.0.31.patch.sql** — Main DB updates (run against `panda_db`)
2. **0.0.31.cron.patch.sql** — Cron job updates (run where `pg_cron` is installed)
3. **0.0.31.README.md** — This file

## Order of Operations

1. Apply `0.0.31.patch.sql` to `panda_db`
2. Apply `0.0.31.cron.patch.sql` to the DB that hosts `pg_cron`